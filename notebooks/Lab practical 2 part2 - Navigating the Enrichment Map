{
 "cells": [
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "# Lab practical 3 - Navigating the Enrichment Map "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "-------------------"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "**Table of Contents:**\n",
    "  1. <a href=#navigate>Navigate network</a>\n",
    "  1. <a href=#individual>Investigating and viewing results for individual sets</a>\n",
    "  1. <a href=#filter>Filter results based on p-value, q-value or similarity coeffecient</a>\n",
    "  1. <a href=#annotate>Annotate network</a>"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "-------------------"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "Once the Enrichment Map is created the next step involves interpreting and refining it to ultimately create a figure that can be used to explain the question of interest or uncover new avenues of research.  There are many Cytoscape features and third –party Apps that can help analyze and refine an Enrichment Map.   A few of these are explored in this protocol but only brush the surface of what can be done within Cytoscape. "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "<a id='navigate'></a>"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## 1. Navigating and exploring the map "
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "<a id='figure1C'></a>"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### General layout of Cytoscape panel\n",
    "In control panel located at the left side of the Cytoscape window, select the network of interest. A bird’s eye view of the network is located at the bottom of the panel (figure A). Note that pathways that share a lot of genes in common will be grouped as a module or cluster and often represent a similar biological process. \n",
    "<img  src=\"workshop_figures/Cytoscape_Main_panels.png\">"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Enabling detailed network view\n",
    "In the menu bar, select  View  Show Graphic details . \n",
    "<img  src=\"workshop_figures/show_graphic_details.png\">"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "\n",
    "It will turn the squared nodes into circles and the gene-set labels will be visible.\n",
    "<img  src=\"workshop_figures/show_graphic_details_result.png\">"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Zooming\n",
    "Zoom in or out using + or - in toolbar or scroll button on mouse until you are able to read the labels comfortably.\n",
    "<img  src=\"workshop_figures/tool_bar.png\">"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "### Navigating within the network\n",
    "Use the bird’s eye view (located at the bottom of the control panel) to navigate around the network by moving the  blue rectangle using the mouse or trackpad.\n",
    "<img  src=\"workshop_figures/birds_eye.png\">"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "<a id='individual'></a>"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## 2. Investigating and viewing results for individual sets"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "* Click on an individual node of interst.  For this example selected \"Integrin signalling pathway\"\n",
    "    ><span style=\"color:purple\">** TIP: Selected nodes appear yellow (or highlighted) in the network** </span>\n",
    "* In the Table Panel in the \"Heat map (nodes)\" tab change:\n",
    "  * Normalizaion from \"Data as is\" to \"Row Normalize Data\"\n",
    "  * Sorting from \"Hierarchical clustering\" to \"GSEARanking-Dataset 1\"\n",
    "  <img  src=\"workshop_figures/individual.png\">\n",
    "  \n",
    "      ><span style=\"color:purple\">** Tip: Genes in the heatmap that are highlighted yellow represent genes part of the leading edge for this gene set, i.e. contributed the most to the enriched phenotype.  Leading edge genes will only be highlighted if an individual node has been selected and the Enrichment Map was created from GSEA results. ** </span>"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "<a id='filter'></a>"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## 3. Filter results based on p-value, q-value or similarity coeffecient\n",
    "* If the network is too busy with too many nodes you can adjust the p-value and q–value threshold using the sliders in the legend panel(<a href=#figure1C>Figure</a> C).  This will change the threshold used when creating the network and hide any nodes that do not pass the new threshold.  To add nodes back to the network simply adjust the slider to its original position. \n",
    "><span style=\"color:red\">** ?TROUBLESHOOTING: Unable to see “Legend Panel”.  Click on View --> Show Results panel. In Results panel on right hand side of Cytoscape window select “Legend” tab. ** </span>\n",
    "\n",
    "  <img  src=\"workshop_figures/pvalue_sliders.png\">\n",
    "* If the network is too inter-connected you can adjust the similarity coefficient threshold to remove edges.  This will change the threshold used when creating the network and hide any edges that do not pass the new threshold.  To add edges back to the network simply adjust the slider to its original position.\n",
    "  <img  src=\"workshop_figures/similarity_sliders.png\">\n",
    "* Re-layout network - after adjusting cut-offs re-layout network to see how changing the cut-offs affected the network view. We recommend using Layout --> yFiles Layouts --> Organic OR  Layout -->  Perfuse directed Layout --> (none) for best results .  Repeat until the desired general network structure. \n",
    "  <img  src=\"workshop_figures/layout.png\">\n",
    "* The result of filtering and re-laying out the network:\n",
    "  <img  src=\"workshop_figures/updated_layout.png\">"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "<a id='figure'></a>"
   ]
  },
  {
   "cell_type": "markdown",
   "metadata": {},
   "source": [
    "## 4. Create a publication ready picture\n",
    "    1. Group similar classes together \n",
    "     a. Select nodes of one class using Filters\n",
    "       * In Control Panel navigate to “Select” tab\n",
    "       * Click on “+”.\n",
    "       * Select Column filter\n",
    "       * In “Choose column…” dropdown menu select “Node: EM1_NES_dataset1”\n",
    "       * adjust slider to specify all negative values\n",
    "       * Click on “Apply”\n",
    "<img  src=\"workshop_figures/filter.png\">\n",
    "><span style=\"color:red\">** ?TROUBLESHOOTING: if this causes a large subset of the network to be selected a warning message might appear indicating that you are about to cluster (in the gene heat map) a large number of genes.  If you click on \"OK\" cluster will be cancelled and genes will be shown with no sorting.  To cluster the results change value in drop down menu to \"Cluster results anyways\" and click on \"OK\" \n",
    "       <img  src=\"workshop_figures/cluster_warning.png\">\n"
   ]
  },
  {
   "cell_type": "code",
   "execution_count": null,
   "metadata": {
    "collapsed": true
   },
   "outputs": [],
   "source": []
  }
 ],
 "metadata": {
  "kernelspec": {
   "display_name": "R",
   "language": "R",
   "name": "ir"
  },
  "language_info": {
   "codemirror_mode": "r",
   "file_extension": ".r",
   "mimetype": "text/x-r-source",
   "name": "R",
   "pygments_lexer": "r",
   "version": "3.2.2"
  }
 },
 "nbformat": 4,
 "nbformat_minor": 0
}
